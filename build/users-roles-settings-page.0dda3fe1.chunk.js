(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[8853],{20400:(m,p,t)=>{"use strict";t.r(p),t.d(p,{default:()=>Zt});var e=t(53547),i=t(16550),n=t(86597),o=t(31498),l=t(81912),h=t(14087),d=t(17034),A=t(185),D=t(53979),b=t(29728),Z=t(36989),T=t(49066),P=t(38939),L=t(8060),M=t(79031),C=t(37909),y=t(75515),I=t(63237),j=t(96315),B=t(86896),K=t(88767),w=t(89031);const be=async(s,r)=>{try{const{get:a}=(0,n.tg)(),{data:c}=await a((0,w.Gc)("roles"));return r("The roles have loaded successfully"),c}catch{throw s({type:"warning",message:{id:"notification.error"}}),new Error("error")}},Le=async(s,r)=>{try{const{del:a}=(0,n.tg)();await a(`${(0,w.Gc)("roles")}/${s}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var Me=t(45697),U=t.n(Me),Ze=t(15234),k=t(11047),re=t(12028),Oe=t(4585),Se=t(20022);const ne=({sortedRoles:s,canDelete:r,permissions:a,setRoleToDelete:c,onDelete:E})=>{const{formatMessage:u}=(0,B.Z)(),{push:x}=(0,i.k6)(),[f,R]=E,v=g=>r&&!["public","authenticated"].includes(g.type),O=g=>{c(g),R(!f)},S=g=>{x(`/settings/${o.Z}/roles/${g}`)};return e.createElement(Ze.p,null,s?.map(g=>e.createElement(M.Tr,{key:g.name,...(0,n.X7)({fn:()=>S(g.id)})},e.createElement(C.Td,{width:"20%"},e.createElement(y.Z,null,g.name)),e.createElement(C.Td,{width:"50%"},e.createElement(y.Z,null,g.description)),e.createElement(C.Td,{width:"30%"},e.createElement(y.Z,null,`${g.nb_users} ${u({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(C.Td,null,e.createElement(k.k,{justifyContent:"end",...n.UW},e.createElement(n.jW,{permissions:a.updateRole},e.createElement(re.h,{onClick:()=>S(g.id),noBorder:!0,icon:e.createElement(Oe.Z,null),label:u({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${g.name}`})})),v(g)&&e.createElement(n.jW,{permissions:a.deleteRole},e.createElement(re.h,{onClick:()=>O(g.id),noBorder:!0,icon:e.createElement(Se.Z,null),label:u({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${g.name}`})})))))))},Be=ne;ne.defaultProps={canDelete:!1},ne.propTypes={onDelete:U().array.isRequired,permissions:U().object.isRequired,setRoleToDelete:U().func.isRequired,sortedRoles:U().array.isRequired,canDelete:U().bool};const je=()=>{const{trackUsage:s}=(0,n.rS)(),{formatMessage:r,locale:a}=(0,B.Z)(),{push:c}=(0,i.k6)(),E=(0,n.lm)(),{notifyStatus:u}=(0,h.G)(),[{query:x}]=(0,n.Kx)(),f=x?._q||"",[R,v]=(0,e.useState)(!1),[O,S]=(0,e.useState)(!1),[g,W]=(0,e.useState)();(0,n.go)();const H=(0,K.useQueryClient)(),G=(0,e.useMemo)(()=>({create:l.Z.createRole,read:l.Z.readRoles,update:l.Z.updateRole,delete:l.Z.deleteRole}),[]),{isLoading:N,allowedActions:{canRead:$,canDelete:Q}}=(0,n.ss)(G),{isLoading:Ot,data:{roles:Ce},isFetching:St}=(0,K.useQuery)("get-roles",()=>be(E,u),{initialData:{},enabled:$}),{includes:Ae}=(0,n.L0)(a,{sensitivity:"base"}),Pe=(0,n.Xe)(a,{sensitivity:"base"}),Te=Ot||St,Bt=()=>{s("willCreateRole"),c(`/settings/${o.Z}/roles/new`)},jt=()=>{v(!R)},Ut={roles:{id:(0,w.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,w.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},It=r({id:"global.roles",defaultMessage:"Roles"}),kt=(0,K.useMutation)(z=>Le(z,E),{async onSuccess(){await H.invalidateQueries("get-roles")}}),Gt=async()=>{S(!0),await kt.mutateAsync(g),v(!R),S(!1)},te=(Ce||[]).filter(z=>Ae(z.name,f)||Ae(z.description,f)).sort((z,De)=>Pe.compare(z.name,De.name)||Pe.compare(z.description,De.description)),Nt=f&&!te.length?"search":"roles",$t=4,Ft=(Ce?.length||0)+1;return e.createElement(d.A,null,e.createElement(n.SL,{name:It}),e.createElement(A.o,{"aria-busy":Te},e.createElement(D.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(n.jW,{permissions:l.Z.createRole},e.createElement(b.z,{onClick:Bt,startIcon:e.createElement(j.Z,null),size:"S"},r({id:(0,w.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(Z.Z,{startActions:e.createElement(n.m,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(T.D,null,!$&&e.createElement(n.ZF,null),(Te||N)&&e.createElement(n.dO,null),$&&te&&te?.length?e.createElement(P.i,{colCount:$t,rowCount:Ft},e.createElement(L.h,null,e.createElement(M.Tr,null,e.createElement(C.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),e.createElement(C.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.description",defaultMessage:"Description"}))),e.createElement(C.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.users",defaultMessage:"Users"}))),e.createElement(C.Th,null,e.createElement(I.T,null,r({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(Be,{sortedRoles:te,canDelete:Q,permissions:l.Z,setRoleToDelete:W,onDelete:[R,v]})):e.createElement(n.x7,{content:Ut[Nt]})),e.createElement(n.QH,{isConfirmButtonLoading:O,onConfirm:Gt,onToggleDialog:jt,isOpen:R})))},Ue=()=>e.createElement(n.O4,{permissions:l.Z.accessRoles},e.createElement(je,null));var oe=t(41054),F=t(41580),q=t(11276),V=t(74571),ie=t(16364),le=t(61467),ce=t(85018),Ie=t(67109),Y=t(84757),ke=t(27361),J=t.n(ke),Ge=t(41609),Ne=t.n(Ge),$e=t(82569),Fe=t.n($e);const de=(0,e.createContext)({}),ue=({children:s,value:r})=>e.createElement(de.Provider,{value:r},s),se=()=>(0,e.useContext)(de);ue.propTypes={children:U().node.isRequired,value:U().object.isRequired};var _=t(88972),we=t(35161),We=t.n(we),He=t(13217),Ke=t.n(He);const Ve=s=>{switch(s){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},ze=(0,_.ZP)(F.x)`
  margin: -1px;
  border-radius: ${({theme:s})=>s.spaces[1]} 0 0 ${({theme:s})=>s.spaces[1]};
`;function ae({route:s}){const{formatMessage:r}=(0,B.Z)(),{method:a,handler:c,path:E}=s,u=E?Ke()(E.split("/")):[],[x="",f=""]=c?c.split("."):[],R=Ve(s.method);return e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(y.Z,{variant:"delta",as:"h3"},r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,x),e.createElement(y.Z,{variant:"delta",textColor:"primary600"},".",f)),e.createElement(k.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(ze,{background:R.background,borderColor:R.border,padding:2},e.createElement(y.Z,{fontWeight:"bold",textColor:R.text},a)),e.createElement(F.x,{paddingLeft:2,paddingRight:2},We()(u,v=>e.createElement(y.Z,{key:v,textColor:v.includes(":")?"neutral600":"neutral900"},"/",v)))))}ae.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ae.propTypes={route:U().shape({handler:U().string,method:U().string,path:U().string})};const Ye=ae,Xe=()=>{const{formatMessage:s}=(0,B.Z)(),{selectedAction:r,routes:a}=se(),c=Fe()(r.split("."),"controllers"),E=J()(a,c[0]),u=c.slice(1).join("."),x=Ne()(E)?[]:E.filter(f=>f.handler.endsWith(u));return e.createElement(V.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},x.map((f,R)=>e.createElement(Ye,{key:R,route:f}))):e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(y.Z,{variant:"delta",as:"h3"},s({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(y.Z,{as:"p",textColor:"neutral600"},s({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Qe=t(48734),Je=t(74756),qe=t(63081),_e=t(11700),et=t.n(_e);function tt(s){switch(s){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return et()(s.replace("api::","").replace("plugin::",""))}}const nt=tt;var st=t(89734),me=t.n(st),ge=t(36213),at=t(78114);const pe=_.iv`
  background: ${s=>s.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,rt=(0,_.ZP)(F.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${s=>s.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${s=>s.isActive&&pe}
  &:hover {
    ${pe}
  }
`,ot=_.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,he=({subCategory:s})=>{const{formatMessage:r}=(0,B.Z)(),{onChange:a,onChangeSelectAll:c,onSelectedAction:E,selectedAction:u,modifiedData:x}=se(),f=(0,e.useMemo)(()=>J()(x,s.name,{}),[x,s]),R=(0,e.useMemo)(()=>Object.values(f).every(g=>g.enabled===!0),[f]),v=(0,e.useMemo)(()=>Object.values(f).some(g=>g.enabled===!0)&&!R,[f,R]),O=(0,e.useCallback)(({target:{name:g}})=>{c({target:{name:g,value:!R}})},[R,c]),S=(0,e.useCallback)(g=>u===g,[u]);return e.createElement(F.x,null,e.createElement(k.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(F.x,{paddingRight:4},e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s.label)),e.createElement(ot,null),e.createElement(F.x,{paddingLeft:4},e.createElement(ge.X,{name:s.name,value:R,onValueChange:g=>O({target:{name:s.name,value:g}}),indeterminate:v},r({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(k.k,{paddingTop:6,paddingBottom:6},e.createElement(q.r,{gap:2,style:{flex:1}},s.actions.map(g=>{const W=`${g.name}.enabled`;return e.createElement(V.P,{col:6,key:g.name},e.createElement(rt,{isActive:S(g.name),padding:2,hasRadius:!0},e.createElement(ge.X,{value:J()(x,W,!1),name:W,onValueChange:H=>a({target:{name:W,value:H}})},g.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>E(g.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(at.Z,null))))}))))};he.propTypes={subCategory:U().object.isRequired};const it=he,Ee=({name:s,permissions:r})=>{const a=(0,e.useMemo)(()=>me()(Object.values(r.controllers).reduce((c,E,u)=>{const x=`${s}.controllers.${Object.keys(r.controllers)[u]}`,f=me()(Object.keys(E).reduce((R,v)=>[...R,{...E[v],label:v,name:`${x}.${v}`}],[]),"label");return[...c,{actions:f,label:Object.keys(r.controllers)[u],name:x}]},[]),"label"),[s,r]);return e.createElement(F.x,{padding:6},a.map(c=>e.createElement(it,{key:c.name,subCategory:c})))};Ee.propTypes={name:U().string.isRequired,permissions:U().object.isRequired};const lt=Ee,ct=(s,r)=>{const a=Object.keys(r).sort().map(c=>({name:c,isOpen:!1}));return{...s,collapses:a}};var ee=t(18172);const dt={collapses:[]},ut=(s,r)=>(0,ee.ZP)(s,a=>{switch(r.type){case"TOGGLE_COLLAPSE":{a.collapses=s.collapses.map((c,E)=>E===r.index?{...c,isOpen:!c.isOpen}:{...c,isOpen:!1});break}default:return a}}),mt=()=>{const{modifiedData:s}=se(),{formatMessage:r}=(0,B.Z)(),[{collapses:a},c]=(0,e.useReducer)(ut,dt,u=>ct(u,s)),E=u=>c({type:"TOGGLE_COLLAPSE",index:u});return e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:1},a.map((u,x)=>e.createElement(Qe.U,{expanded:u.isOpen,onToggle:()=>E(x),key:u.name,variant:x%2===0?"secondary":void 0},e.createElement(Je.B,{title:nt(u.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:u.name}),variant:x%2?"primary":"secondary"}),e.createElement(qe.v,null,e.createElement(F.x,null,e.createElement(lt,{permissions:s[u.name],name:u.name}))))))};var gt=t(36968),fe=t.n(gt),pt=t(69572),ht=t.n(pt);const Et={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ft=(s,r)=>(0,ee.ZP)(s,a=>{switch(r.type){case"ON_CHANGE":{const c=r.keys.length,E=r.keys[c-1]==="enabled";if(r.value&&E){const u=ht()(r.keys,c-1).join(".");a.selectedAction=u}fe()(a,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const c=["modifiedData",...r.keys],E=J()(s,c,{}),u=Object.keys(E).reduce((x,f)=>(x[f]={...E[f],enabled:r.value},x),{});fe()(a,c,u);break}case"ON_RESET":{a.modifiedData=s.initialData;break}case"ON_SUBMIT_SUCCEEDED":{a.initialData=s.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:c}=r;a.selectedAction=c===s.selectedAction?"":c;break}default:return a}}),vt=(s,r,a)=>({...s,initialData:r,modifiedData:r,routes:a}),ve=(0,e.forwardRef)(({permissions:s,routes:r},a)=>{const{formatMessage:c}=(0,B.Z)(),[E,u]=(0,e.useReducer)(ft,Et,O=>vt(O,s,r));(0,e.useImperativeHandle)(a,()=>({getPermissions(){return{permissions:E.modifiedData}},resetForm(){u({type:"ON_RESET"})},setFormAfterSubmit(){u({type:"ON_SUBMIT_SUCCEEDED"})}}));const v={...E,onChange:({target:{name:O,value:S}})=>u({type:"ON_CHANGE",keys:O.split("."),value:S==="empty__string_value"?"":S}),onChangeSelectAll:({target:{name:O,value:S}})=>u({type:"ON_CHANGE_SELECT_ALL",keys:O.split("."),value:S}),onSelectedAction:O=>u({type:"SELECT_ACTION",actionToSelect:O})};return e.createElement(ue,{value:v},e.createElement(q.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(V.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(y.Z,{variant:"delta",as:"h2"},c({id:(0,Y.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(y.Z,{as:"p",textColor:"neutral600"},c({id:(0,Y.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(mt,null))),e.createElement(Xe,null)))});ve.propTypes={permissions:U().object.isRequired,routes:U().object.isRequired};const ye=(0,e.memo)(ve),Jt={isLoading:!0,modifiedData:{}},qt=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.modifiedData={};break}case"GET_DATA_SUCCEEDED":{a.isLoading=!1,a.modifiedData=r.data;break}case"GET_DATA_ERROR":{a.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{a.modifiedData=r.data;break}default:return a}}),_t=null,en=(s,r)=>{const{isLoading:a,allowedActions:c}=useRBAC(r),[{isLoading:E,modifiedData:u},x]=useReducer(reducer,initialState),f=useNotification(),R=useRef(!0),{get:v}=useFetchClient();useEffect(()=>(a||(async()=>{try{x({type:"GET_DATA"});const{data:g}=await v(getRequestURL(s));x({type:"GET_DATA_SUCCEEDED",data:g})}catch(g){R.current&&(x({type:"GET_DATA_ERROR"}),console.error(g),f({type:"warning",message:{id:"notification.error"}}))}})(),()=>{R.current=!1}),[a,s,v,f]);const O=useCallback(S=>{x({type:"ON_SUBMIT_SUCCEEDED",data:S})},[]);return{allowedActions:c,dispatchSubmitSucceeded:O,isLoading:E,isLoadingForPermissions:a,modifiedData:u}},tn=null,nn={roles:[],isLoading:!0},sn=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.roles=[];break}case"GET_DATA_SUCCEEDED":{a.roles=r.data,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),an=null,rn=(s=!0)=>{const[{roles:r,isLoading:a},c]=useReducer(reducer,initialState,()=>init(initialState,s)),E=useNotification(),u=useRef(!0),x=useFetchClient(),f=useCallback(async()=>{try{c({type:"GET_DATA"});const{data:{roles:R}}=await x.get(`/${pluginId}/roles`);c({type:"GET_DATA_SUCCEEDED",data:R})}catch(R){const v=get(R,["response","payload","message"],"An error occured");u.current&&(c({type:"GET_DATA_ERROR"}),v!=="Forbidden"&&E({type:"warning",message:v}))}},[x,E]);return useEffect(()=>(s&&f(),()=>{u.current=!1}),[s,f]),{roles:r,isLoading:a,getData:f}},on=null,yt=(s,r)=>({...s,isLoading:r}),Re={permissions:{},routes:{},isLoading:!0},Rt=(s,r)=>(0,ee.ZP)(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.permissions={},a.routes={};break}case"GET_DATA_SUCCEEDED":{a.permissions=r.permissions,a.routes=r.routes,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),xe=(s=!0)=>{const r=(0,n.lm)(),[{permissions:a,routes:c,isLoading:E},u]=(0,e.useReducer)(Rt,Re,()=>yt(Re,s)),x=(0,n.kY)(),f=(0,e.useCallback)(async()=>{try{u({type:"GET_DATA"});const[{permissions:R},{routes:v}]=await Promise.all([`/${o.Z}/permissions`,`/${o.Z}/routes`].map(async O=>(await x.get(O)).data));u({type:"GET_DATA_SUCCEEDED",permissions:(0,w.YX)(R),routes:v})}catch(R){const v=J()(R,["response","payload","message"],"An error occured");u({type:"GET_DATA_ERROR"}),v!=="Forbidden"&&r({type:"warning",message:v})}},[r]);return(0,e.useEffect)(()=>{s&&f()},[f,s]),{permissions:a,routes:c,getData:f,isLoading:E}},xt={role:{},isLoading:!0},Ct=(s,r)=>(0,ee.ZP)(s,a=>{switch(r.type){case"GET_DATA_SUCCEEDED":{a.role=r.role,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{a.role.name=r.name,a.role.description=r.description;break}default:return a}}),At=s=>{const[r,a]=(0,e.useReducer)(Ct,xt),c=(0,n.lm)(),E=(0,e.useRef)(null),{get:u}=(0,n.kY)();(0,e.useEffect)(()=>(E.current=!0,s?x(s):a({type:"GET_DATA_SUCCEEDED",role:{}}),()=>E.current=!1),[s]);const x=async R=>{try{const{data:{role:v}}=await u(`/${o.Z}/roles/${R}`);E.current&&a({type:"GET_DATA_SUCCEEDED",role:v})}catch(v){console.error(v),a({type:"GET_DATA_ERROR"}),c({type:"warning",message:{id:"notification.error"}})}},f=(0,e.useCallback)(R=>{a({type:"ON_SUBMIT_SUCCEEDED",...R})},[]);return{...r,onSubmitSucceeded:f}};var X=t(87561);const Pt=X.Ry().shape({name:X.Z_().required(n.I0.required),description:X.Z_().required(n.I0.required)}),Tt=()=>{const{formatMessage:s}=(0,B.Z)(),[r,a]=(0,e.useState)(!1),c=(0,n.lm)(),{lockApp:E,unlockApp:u}=(0,n.o1)(),{params:{id:x}}=(0,i.$B)(`/settings/${o.Z}/roles/:id`),{isLoading:f,routes:R}=xe(),{role:v,onSubmitSucceeded:O,isLoading:S}=At(x),g=(0,e.useRef)(),{put:W}=(0,n.kY)(),H=async G=>{E(),a(!0);try{const N=g.current.getPermissions();await W(`/${o.Z}/roles/${x}`,{...G,...N,users:[]}),O({name:G.name,description:G.description}),c({type:"success",message:{id:(0,Y.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(N){console.error(N),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),u()};return S?e.createElement(n.dO,null):e.createElement(A.o,null,e.createElement(n.SL,{name:"Roles"}),e.createElement(oe.J9,{enableReinitialize:!0,initialValues:{name:v.name,description:v.description},onSubmit:H,validationSchema:Pt},({handleSubmit:G,values:N,handleChange:$,errors:Q})=>e.createElement(n.l0,{noValidate:!0,onSubmit:G},e.createElement(D.T,{primaryAction:!f&&e.createElement(b.z,{disabled:v.code==="strapi-super-admin",type:"submit",loading:r,startIcon:e.createElement(ce.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:v.name,subtitle:v.description,navigationAction:e.createElement(n.rU,{startIcon:e.createElement(Ie.Z,null),to:"/settings/users-permissions/roles"},s({id:"global.back",defaultMessage:"Back"}))}),e.createElement(T.D,null,e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(F.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(y.Z,{variant:"delta",as:"h2"},s({id:(0,Y.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:N.name||"",onChange:$,label:s({id:"global.name",defaultMessage:"Name"}),error:Q.name?s({id:Q.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:N.description||"",onChange:$,label:s({id:"global.description",defaultMessage:"Description"}),error:Q.description?s({id:Q.description,defaultMessage:"Invalid value"}):null}))))),!f&&e.createElement(ye,{ref:g,permissions:v.permissions,routes:R}))))))},Dt=()=>e.createElement(n.O4,{permissions:l.Z.updateRole},e.createElement(Tt,null)),bt=X.Ry().shape({name:X.Z_().required(n.I0.required),description:X.Z_().required(n.I0.required)}),Lt=()=>{const{formatMessage:s}=(0,B.Z)(),[r,a]=(0,e.useState)(!1),c=(0,n.lm)(),{goBack:E}=(0,i.k6)(),{lockApp:u,unlockApp:x}=(0,n.o1)(),{isLoading:f,permissions:R,routes:v}=xe(),{trackUsage:O}=(0,n.rS)(),S=(0,e.useRef)(),{post:g}=(0,n.kY)(),W=async H=>{u(),a(!0);try{const G=S.current.getPermissions();await g(`/${o.Z}/roles`,{...H,...G,users:[]}),O("didCreateRole"),c({type:"success",message:{id:(0,Y.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),E()}catch(G){console.error(G),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),x()};return e.createElement(A.o,null,e.createElement(n.SL,{name:"Roles"}),e.createElement(oe.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:W,validationSchema:bt},({handleSubmit:H,values:G,handleChange:N,errors:$})=>e.createElement(n.l0,{noValidate:!0,onSubmit:H},e.createElement(D.T,{primaryAction:!f&&e.createElement(b.z,{type:"submit",loading:r,startIcon:e.createElement(ce.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(T.D,null,e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(F.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(k.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(y.Z,{variant:"delta",as:"h2"},s({id:(0,Y.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:G.name||"",onChange:N,label:s({id:"global.name",defaultMessage:"Name"}),error:$.name?s({id:$.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:G.description||"",onChange:N,label:s({id:"global.description",defaultMessage:"Description"}),error:$.description?s({id:$.description,defaultMessage:"Invalid value"}):null}))))),!f&&e.createElement(ye,{ref:S,permissions:R,routes:v}))))))},Mt=()=>e.createElement(n.O4,{permissions:l.Z.createRole},e.createElement(Lt,null)),Zt=()=>e.createElement(n.O4,{permissions:l.Z.accessRoles},e.createElement(i.rs,null,e.createElement(i.AW,{path:`/settings/${o.Z}/roles/new`,component:Mt,exact:!0}),e.createElement(i.AW,{path:`/settings/${o.Z}/roles/:id`,component:Dt,exact:!0}),e.createElement(i.AW,{path:`/settings/${o.Z}/roles`,component:Ue,exact:!0}),e.createElement(i.AW,{path:"",component:n.Hn})))},89031:(m,p,t)=>{"use strict";t.d(p,{YX:()=>o,Gc:()=>d,OB:()=>A.Z});var e=t(41609),i=t.n(e);const o=D=>Object.keys(D).reduce((b,Z)=>{const T=D[Z].controllers,P=Object.keys(T).reduce((L,M)=>(i()(T[M])||(L[M]=T[M]),L),{});return i()(P)||(b[Z]={controllers:P}),b},{});var l=t(31498);const d=D=>`/${l.Z}/${D}`;var A=t(84757)},47443:(m,p,t)=>{var e=t(42118);function i(n,o){var l=n==null?0:n.length;return!!l&&e(n,o,0)>-1}m.exports=i},1196:m=>{function p(t,e,i){for(var n=-1,o=t==null?0:t.length;++n<o;)if(i(e,t[n]))return!0;return!1}m.exports=p},20731:(m,p,t)=>{var e=t(88668),i=t(47443),n=t(1196),o=t(29932),l=t(7518),h=t(74757),d=200;function A(D,b,Z,T){var P=-1,L=i,M=!0,C=D.length,y=[],I=b.length;if(!C)return y;Z&&(b=o(b,l(Z))),T?(L=n,M=!1):b.length>=d&&(L=h,M=!1,b=new e(b));e:for(;++P<C;){var j=D[P],B=Z==null?j:Z(j);if(j=T||j!==0?j:0,M&&B===B){for(var K=I;K--;)if(b[K]===B)continue e;y.push(j)}else L(b,B,T)||y.push(j)}return y}m.exports=A},89881:(m,p,t)=>{var e=t(47816),i=t(99291),n=i(e);m.exports=n},41848:m=>{function p(t,e,i,n){for(var o=t.length,l=i+(n?1:-1);n?l--:++l<o;)if(e(t[l],l,t))return l;return-1}m.exports=p},42118:(m,p,t)=>{var e=t(41848),i=t(62722),n=t(42351);function o(l,h,d){return h===h?n(l,h,d):e(l,i,d)}m.exports=o},62722:m=>{function p(t){return t!==t}m.exports=p},69199:(m,p,t)=>{var e=t(89881),i=t(98612);function n(o,l){var h=-1,d=i(o)?Array(o.length):[];return e(o,function(A,D,b){d[++h]=l(A,D,b)}),d}m.exports=n},82689:(m,p,t)=>{var e=t(29932),i=t(97786),n=t(67206),o=t(69199),l=t(71131),h=t(7518),d=t(85022),A=t(6557),D=t(1469);function b(Z,T,P){T.length?T=e(T,function(C){return D(C)?function(y){return i(y,C.length===1?C[0]:C)}:C}):T=[A];var L=-1;T=e(T,h(n));var M=o(Z,function(C,y,I){var j=e(T,function(B){return B(C)});return{criteria:j,index:++L,value:C}});return l(M,function(C,y){return d(C,y,P)})}m.exports=b},71131:m=>{function p(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}m.exports=p},26393:(m,p,t)=>{var e=t(33448);function i(n,o){if(n!==o){var l=n!==void 0,h=n===null,d=n===n,A=e(n),D=o!==void 0,b=o===null,Z=o===o,T=e(o);if(!b&&!T&&!A&&n>o||A&&D&&Z&&!b&&!T||h&&D&&Z||!l&&Z||!d)return 1;if(!h&&!A&&!T&&n<o||T&&l&&d&&!h&&!A||b&&l&&d||!D&&d||!Z)return-1}return 0}m.exports=i},85022:(m,p,t)=>{var e=t(26393);function i(n,o,l){for(var h=-1,d=n.criteria,A=o.criteria,D=d.length,b=l.length;++h<D;){var Z=e(d[h],A[h]);if(Z){if(h>=b)return Z;var T=l[h];return Z*(T=="desc"?-1:1)}}return n.index-o.index}m.exports=i},99291:(m,p,t)=>{var e=t(98612);function i(n,o){return function(l,h){if(l==null)return l;if(!e(l))return n(l,h);for(var d=l.length,A=o?d:-1,D=Object(l);(o?A--:++A<d)&&h(D[A],A,D)!==!1;);return l}}m.exports=i},42351:m=>{function p(t,e,i){for(var n=i-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}m.exports=p},35161:(m,p,t)=>{var e=t(29932),i=t(67206),n=t(69199),o=t(1469);function l(h,d){var A=o(h)?e:n;return A(h,i(d,3))}m.exports=l},89734:(m,p,t)=>{var e=t(21078),i=t(82689),n=t(5976),o=t(16612),l=n(function(h,d){if(h==null)return[];var A=d.length;return A>1&&o(h,d[0],d[1])?d=[]:A>2&&o(d[0],d[1],d[2])&&(d=[d[0]]),i(h,e(d,1),[])});m.exports=l},13217:(m,p,t)=>{var e=t(14259);function i(n){var o=n==null?0:n.length;return o?e(n,1,o):[]}m.exports=i},69572:(m,p,t)=>{var e=t(14259),i=t(40554);function n(o,l,h){return o&&o.length?(l=h||l===void 0?1:i(l),e(o,0,l<0?0:l)):[]}m.exports=n},82569:(m,p,t)=>{var e=t(20731),i=t(5976),n=t(29246),o=i(function(l,h){return n(l)?e(l,h):[]});m.exports=o},36989:(m,p,t)=>{"use strict";t.d(p,{Z:()=>n});var e=t(85893),i=t(11047);const n=({startActions:o,endActions:l})=>!o&&!l?null:(0,e.jsxs)(i.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(i.k,{gap:2,wrap:"wrap",children:o}),(0,e.jsx)(i.k,{gap:2,shrink:0,wrap:"wrap",children:l})]})},49066:(m,p,t)=>{"use strict";t.d(p,{D:()=>n});var e=t(85893),i=t(41580);const n=({children:o})=>(0,e.jsx)(i.x,{paddingLeft:10,paddingRight:10,children:o})},53979:(m,p,t)=>{"use strict";t.d(p,{A:()=>T,T:()=>b});var e=t(85893),i=t(53547),n=t(88972);const o=P=>{const L=(0,i.useRef)(null),[M,C]=(0,i.useState)(!0),y=([I])=>{C(I.isIntersecting)};return(0,i.useEffect)(()=>{const I=L.current,j=new IntersectionObserver(y,P);return I&&j.observe(L.current),()=>{I&&j.disconnect()}},[L,P]),[L,M]};var l=t(79698);const h=(P,L)=>{const M=(0,l.W)(L);(0,i.useLayoutEffect)(()=>{const C=new ResizeObserver(M);return Array.isArray(P)?P.forEach(y=>{y.current&&C.observe(y.current)}):P.current&&C.observe(P.current),()=>{C.disconnect()}},[P,M])};var d=t(41580),A=t(11047),D=t(75515);const b=P=>{const L=(0,i.useRef)(null),[M,C]=(0,i.useState)(null),[y,I]=o({root:null,rootMargin:"0px",threshold:0});return h(y,()=>{y.current&&C(y.current.getBoundingClientRect())}),(0,i.useEffect)(()=>{L.current&&C(L.current.getBoundingClientRect())},[L]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{height:M?.height},ref:y,children:I&&(0,e.jsx)(T,{ref:L,...P})}),!I&&(0,e.jsx)(T,{...P,sticky:!0,width:M?.width})]})};b.displayName="HeaderLayout";const Z=(0,n.ZP)(d.x)`
  width: ${({width:P})=>P?`${P/16}rem`:void 0};
  z-index: ${({theme:P})=>P.zIndices[1]};
`,T=i.forwardRef(({navigationAction:P,primaryAction:L,secondaryAction:M,subtitle:C,title:y,sticky:I,width:j,...B},K)=>{const w=typeof C=="string";return I?(0,e.jsx)(Z,{paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3,position:"fixed",top:0,right:0,background:"neutral0",shadow:"tableShadow",width:j,"data-strapi-header-sticky":!0,children:(0,e.jsxs)(A.k,{justifyContent:"space-between",children:[(0,e.jsxs)(A.k,{children:[P&&(0,e.jsx)(d.x,{paddingRight:3,children:P}),(0,e.jsxs)(d.x,{children:[(0,e.jsx)(D.Z,{variant:"beta",as:"h1",...B,children:y}),w?(0,e.jsx)(D.Z,{variant:"pi",textColor:"neutral600",children:C}):C]}),M?(0,e.jsx)(d.x,{paddingLeft:4,children:M}):null]}),(0,e.jsx)(A.k,{children:L?(0,e.jsx)(d.x,{paddingLeft:2,children:L}):void 0})]})}):(0,e.jsxs)(d.x,{ref:K,paddingLeft:10,paddingRight:10,paddingBottom:8,paddingTop:P?6:8,background:"neutral100","data-strapi-header":!0,children:[P?(0,e.jsx)(d.x,{paddingBottom:2,children:P}):null,(0,e.jsxs)(A.k,{justifyContent:"space-between",children:[(0,e.jsxs)(A.k,{minWidth:0,children:[(0,e.jsx)(D.Z,{as:"h1",variant:"alpha",...B,children:y}),M?(0,e.jsx)(d.x,{paddingLeft:4,children:M}):null]}),L]}),w?(0,e.jsx)(D.Z,{variant:"epsilon",textColor:"neutral600",as:"p",children:C}):C]})})},17034:(m,p,t)=>{"use strict";t.d(p,{A:()=>h});var e=t(85893),i=t(88972),n=t(41580);const o=(0,i.ZP)(n.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:d})=>d?"auto 1fr":"1fr"};
`,l=(0,i.ZP)(n.x)`
  overflow-x: hidden;
`,h=({sideNav:d,children:A})=>(0,e.jsxs)(o,{hasSideNav:!!d,children:[d,(0,e.jsx)(l,{paddingBottom:10,children:A})]})},185:(m,p,t)=>{"use strict";t.d(p,{o:()=>l});var e=t(85893),i=t(88972),n=t(41580);const o=(0,i.ZP)(n.x)`
  // To prevent global outline on focus visible to force an outline when Main is focused
  &:focus-visible {
    outline: none;
  }
`,l=({labelledBy:h="main-content-title",...d})=>(0,e.jsx)(o,{"aria-labelledby":h,as:"main",id:"main-content",tabIndex:-1,...d})},67109:(m,p,t)=>{"use strict";t.d(p,{Z:()=>n});var e=t(85893);const i=o=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...o,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),n=i},78114:(m,p,t)=>{"use strict";t.d(p,{Z:()=>n});var e=t(85893);const i=o=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...o,children:(0,e.jsx)("path",{fill:"#212134",fillRule:"evenodd",d:"M2.68 9.192c-.6.276-2.114 1.18-2.306 1.303a.792.792 0 0 0-.374.68v1.65a.797.797 0 0 0 .384.687c.254.16 1.73 1.042 2.306 1.303l.744 1.8c-.24.634-.67 2.333-.72 2.554a.797.797 0 0 0 .216.744l1.167 1.166a.801.801 0 0 0 .744.216l.03-.008c.36-.092 1.946-.498 2.523-.712l1.8.744c.276.6 1.181 2.115 1.304 2.307a.805.805 0 0 0 .679.374h1.649a.797.797 0 0 0 .686-.384c.16-.254 1.042-1.73 1.303-2.306l1.8-.744c.634.24 2.333.67 2.554.72a.797.797 0 0 0 .744-.216l1.166-1.167a.803.803 0 0 0 .216-.744l-.008-.03c-.092-.36-.498-1.946-.712-2.523l.744-1.8c.6-.276 2.115-1.181 2.307-1.304a.804.804 0 0 0 .374-.679v-1.649a.796.796 0 0 0-.382-.679c-.254-.16-1.73-1.041-2.306-1.303l-.744-1.8c.24-.634.67-2.333.72-2.554a.796.796 0 0 0-.216-.744l-1.166-1.173a.802.802 0 0 0-.744-.216l-.03.008c-.361.092-1.947.498-2.524.712l-1.8-.744c-.276-.6-1.18-2.115-1.303-2.307a.803.803 0 0 0-.68-.374h-1.65a.797.797 0 0 0-.68.382c-.16.254-1.041 1.73-1.303 2.306l-1.8.744c-.634-.24-2.333-.67-2.554-.72a.797.797 0 0 0-.744.216L2.921 4.094a.802.802 0 0 0-.216.744l.008.03c.092.361.498 1.947.712 2.524l-.744 1.8ZM12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",clipRule:"evenodd"})}),n=i}}]);
