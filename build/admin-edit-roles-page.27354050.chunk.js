(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[2544],{23341:(Y,G,r)=>{"use strict";r.r(G),r.d(G,{CreatePage:()=>Re,default:()=>Ne});var e=r(53547),v=r(6406),i=r(86597),D=r(185),B=r(53979),x=r(11047),A=r(29728),$=r(49066),O=r(41580),U=r(75515),Z=r(11276),W=r(74571),j=r(16364),y=r(61467),be=r(67109),$e=r(41054),ve=r(27361),Le=r.n(ve),P=r(41609),q=r.n(P),De=r(86896),C=r(16550),re=r(88972),me=r(18280),te=r(95428),xe=r(87751),ae=r(87561);const ge=ae.Ry().shape({name:ae.Z_().required(i.I0.required),description:ae.Z_().required(i.I0.required)}),fe=re.ZP.div`
  border: 1px solid ${({theme:H})=>H.colors.primary200};
  background: ${({theme:H})=>H.colors.primary100};
  padding: ${({theme:H})=>`${H.spaces[2]} ${H.spaces[4]}`};
  color: ${({theme:H})=>H.colors.primary600};
  border-radius: ${({theme:H})=>H.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,Re=()=>{const H=(0,i.lm)(),{lockApp:ne,unlockApp:M}=(0,i.o1)(),{formatMessage:L}=(0,De.Z)(),[J,se]=(0,e.useState)(!1),{replace:_}=(0,C.k6)(),z=(0,e.useRef)(),{trackUsage:ee}=(0,i.rS)(),je=(0,C.$B)("/settings/roles/duplicate/:id"),he=Le()(je,"params.id",null),{isLoading:ke,data:le}=(0,te.U_)(),{permissions:Ae,isLoading:Pe}=(0,te.Dq)(he),{post:Ze,put:Se}=(0,i.kY)(),Ve=Q=>{ne(),se(!0),ee(he?"willDuplicateRole":"willCreateNewRole"),Promise.resolve(Ze("/admin/roles",Q)).then(async({data:I})=>{const{permissionsToSend:N}=z.current.getPermissions();return ee(he?"didDuplicateRole":"didCreateNewRole"),I.data.id&&!q()(N)&&await Se(`/admin/roles/${I.data.id}/permissions`,{permissions:N}),I}).then(I=>{se(!1),H({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),_(`/settings/roles/${I.data.id}`)}).catch(I=>{console.error(I),se(!1),H({type:"warning",message:{id:"notification.error"}})}).finally(()=>{M()})},Te=`${L({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,v.Z)(new Date,"PPP")}`;return e.createElement(D.o,null,e.createElement(i.SL,{name:"Roles"}),e.createElement($e.J9,{initialValues:{name:"",description:Te},onSubmit:Ve,validationSchema:ge,validateOnChange:!1},({handleSubmit:Q,values:I,errors:N,handleReset:ce,handleChange:de})=>e.createElement(i.l0,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(B.T,{primaryAction:e.createElement(x.k,{gap:2},e.createElement(A.z,{variant:"secondary",onClick:()=>{ce(),z.current.resetForm()},size:"L"},L({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(A.z,{onClick:Q,loading:J,size:"L"},L({id:"global.save",defaultMessage:"Save"}))),title:L({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:L({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(i.rU,{startIcon:e.createElement(be.Z,null),to:"/settings/roles"},L({id:"global.back",defaultMessage:"Back"}))}),e.createElement($.D,null,e.createElement(x.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(O.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(x.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(x.k,{justifyContent:"space-between"},e.createElement(O.x,null,e.createElement(O.x,null,e.createElement(U.Z,{fontWeight:"bold"},L({id:"global.details",defaultMessage:"Details"}))),e.createElement(O.x,null,e.createElement(U.Z,{variant:"pi",textColor:"neutral600"},L({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(fe,null,L({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(Z.r,{gap:4},e.createElement(W.P,{col:6},e.createElement(j.o,{name:"name",error:N.name&&L({id:N.name}),label:L({id:"global.name",defaultMessage:"Name"}),onChange:de,value:I.name})),e.createElement(W.P,{col:6},e.createElement(y.g,{label:L({id:"global.description",defaultMessage:"Description"}),id:"description",error:N.description&&L({id:N.description}),onChange:de},I.description))))),!ke&&!Pe?e.createElement(O.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(me.Z,{isFormDisabled:!1,ref:z,permissions:Ae,layout:le})):e.createElement(O.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(i.dO,null))))))))};function Ne(){return e.createElement(i.O4,{permissions:xe.Z.settings.roles.create},e.createElement(Re,null))}},18280:(Y,G,r)=>{"use strict";r.d(G,{Z:()=>_n});var e=r(53547),v=r(45697),i=r.n(v),D=r(86597),B=r(82777),x=r(77296),A=r(42761),$=r(18721),O=r.n($),U=r(41609),Z=r.n(U),W=r(86896),j=r(41580),y=r(88972),be=r(89734),$e=r.n(be),ve=r(52337),Le=r(66942),P=r(11047),q=r(92155),De=r(27361),C=r.n(De),re=r(57557),me=r.n(re),te=r(95428),xe=r(78114),ae=r(29728);const He=y.ZP.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,ge=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:a}=(0,W.Z)();return e.createElement(He,{hasConditions:o,className:n},e.createElement(ae.z,{variant:s,startIcon:e.createElement(xe.Z,null),onClick:t},a({id:"global.settings",defaultMessage:"Settings"})))};ge.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},ge.propTypes={onClick:i().func.isRequired,className:i().string,hasConditions:i().bool,variant:i().string};const fe=(0,y.ZP)(ge)``;var Re=r(42866),Ne=r(24969),H=r(2407),ne=r(59946),M=r(75515),L=r(36856),J=r(18172),se=r(7739),_=r.n(se),z=r(11700),ee=r.n(z),je=r(38953);const he=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),ke=t=>t.reduce((n,[o,s])=>(n.push({label:ee()(o),children:s.map(a=>({label:a.displayName,value:a.id}))}),n),[]),le=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),Ae=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:a,onChange:l,value:c})=>{const{formatMessage:d}=(0,W.Z)(),m=u=>{l(a,le(t,u))};return e.createElement(P.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(P.k,{paddingLeft:6,style:{width:180}},e.createElement(M.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(M.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(M.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(j.x,{style:{maxWidth:430,width:"100%"}},e.createElement(je.Q,{id:a,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:he(c),options:ke(t),disabled:n})))};Ae.propTypes={arrayOfOptionsGroupedByCategory:i().array.isRequired,isFormDisabled:i().bool.isRequired,isGrey:i().bool.isRequired,label:i().string.isRequired,name:i().string.isRequired,value:i().object.isRequired,onChange:i().func.isRequired};const Pe=Ae,Ze=(t,n)=>t.reduce((o,s)=>(o[s.id]=C()(n,s.id,!1),o),{}),Se=(t,n)=>t.reduce((o,s)=>{const[a,l]=s,c=Ze(l,n);return o[a]=c,o},{}),Te=(t,n,o)=>t.reduce((s,a)=>{const l=C()(n,[...a.pathToConditionsObject,"conditions"],{}),c=Se(o,l);return s[a.pathToConditionsObject.join("..")]=c,s},{}),Q=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:a})=>{const{formatMessage:l}=(0,W.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=(0,te.$_)(),u=(0,e.useMemo)(()=>Object.entries(_()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:S,hasAllActionsSelected:R})=>g&&(S||R)),f=(0,e.useMemo)(()=>Te(p,d,u),[p,d,u]),[E,k]=(0,e.useState)(f),b=(g,S)=>{k((0,J.ZP)(R=>{R[g]||(R[g]={}),R[g].default||(R[g].default={}),R[g].default=S}))},h=()=>{const g=Object.entries(E).reduce((S,R)=>{const[T,X]=R,V=Object.values(X).reduce((K,F)=>({...K,...F}),{});return S[T]=V,S},{});m(g),a()};return e.createElement(Re.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(Ne.x,null,e.createElement(H.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map(g=>e.createElement(H.$,{key:g},ee()(l({id:g,defaultMessage:g})))))),e.createElement(ne.f,null,p.length===0&&e.createElement(M.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:S,pathToConditionsObject:R},T)=>{const X=R.join("..");return e.createElement(Pe,{key:g,arrayOfOptionsGroupedByCategory:u,label:S,isFormDisabled:o,isGrey:T%2===0,name:X,onChange:b,value:C()(E,X,{})})}))),e.createElement(L.m,{startActions:e.createElement(ae.z,{variant:"tertiary",onClick:a},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ae.z,{onClick:h},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};Q.propTypes={actions:i().arrayOf(i().shape({actionId:i().string.isRequired,checkboxName:i().string,hasSomeActionsSelected:i().bool.isRequired,hasAllActionsSelected:i().bool,isDisplayed:i().bool.isRequired,label:i().string})).isRequired,headerBreadCrumbs:i().arrayOf(i().string).isRequired,isFormDisabled:i().bool.isRequired,onClosed:i().func.isRequired,onToggle:i().func.isRequired};const I=Q,N=`${120/16}rem`,ce=`${200/16}rem`,de=`${53/16}rem`,Ge=y.ZP.div`
  width: ${N};
`,st=(0,y.ZP)(P.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,Ke=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:a,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,W.Z)();return e.createElement(P.k,{alignItems:"center",paddingLeft:6,style:{width:ce,flexShrink:0}},e.createElement(j.x,{paddingRight:2},e.createElement(q.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:a}),disabled:s,onValueChange:f=>l({target:{name:d,value:f}}),indeterminate:m,value:u})),e.createElement(st,{title:a,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:f})=>(f==="Enter"||f===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(M.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},ee()(a)),t))};Ke.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Ke.propTypes={checkboxName:i().string,children:i().node,label:i().string.isRequired,isCollapsable:i().bool,isFormDisabled:i().bool.isRequired,onChange:i().func,onClick:i().func.isRequired,someChecked:i().bool,value:i().bool,isActive:i().bool.isRequired};const ot=(0,e.memo)(Ke);var Ft=r(42348),Bt=r.n(Ft),Nt=r(13218),pe=r.n(Nt);const it=t=>pe()(t)?Bt()(Object.values(t).map(n=>pe()(n)?it(n):n)):[],Oe=it,Ue=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,ye=t=>{const n=Ue(t),o=Oe(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),a=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:a}},Vt=(t,n,o)=>t.map(({actionId:s,isDisplayed:a,applyToProperties:l,label:c})=>{if(!a)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:a};const d=[...o.split(".."),s],m=Z()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=C()(n,[...d,"conditions"],null),f=Oe(p).some(h=>h);if(Z()(l)){const h=C()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:h,hasConditions:f,hasSomeActionsSelected:h,isDisplayed:a,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const E=C()(n,m,null),{hasAllActionsSelected:k,hasSomeActionsSelected:b}=ye(E);return{actionId:s,checkboxName:u,hasAllActionsSelected:k,hasConditions:f,hasSomeActionsSelected:b,isDisplayed:a,isParentCheckbox:!0,label:c,pathToConditionsObject:d}});var Wt=r(12645);const Ie=(0,y.ZP)(Wt.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,Fe=t=>`
  ${M.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Ie} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,ze=(t,n)=>`
  ${rt} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${lt} {
    display: flex;
  }
  ${fe} {
    display: block;
  }
  &:hover {
   ${Fe(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>ze(o,s)}
  }
  
`,rt=y.ZP.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${de};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Ht=y.ZP.div`
  display: inline-flex;
  min-width: 100%;

  ${fe} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&ze(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>ze(t,n)}
  }
`,at=(0,y.ZP)(P.k)`
  width: ${N};
  position: relative;
`,lt=(0,y.ZP)(j.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,ct=y.ZP.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Gt=(0,y.ZP)(j.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,dt=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:a,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,W.Z)(),{modifiedData:p,onChangeParentCheckbox:f,onChangeSimpleCheckbox:E}=(0,te.$_)(),k=()=>{m(V=>!V)},b=()=>{m(!1)},h=C()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(h).reduce((V,K)=>(V[K]=me()(h[K],"conditions"),V),{}),[h]),{hasAllActionsSelected:S,hasSomeActionsSelected:R}=ye(g),T=(0,e.useMemo)(()=>Vt(t,p,c),[t,p,c]),X=T.some(({hasConditions:V})=>V);return e.createElement(Ht,{isActive:n},e.createElement(rt,{isGrey:o},e.createElement(ot,{isCollapsable:!0,isFormDisabled:s,label:a,checkboxName:c,onChange:f,onClick:l,someChecked:R,value:S,isActive:n},e.createElement(lt,{paddingLeft:2},n?e.createElement(ve.Z,null):e.createElement(Le.Z,null))),e.createElement(P.k,{style:{flex:1}},T.map(({actionId:V,hasConditions:K,hasAllActionsSelected:F,hasSomeActionsSelected:ie,isDisplayed:Me,isParentCheckbox:w,checkboxName:ue,label:Be})=>Me?w?e.createElement(at,{key:V,justifyContent:"center",alignItems:"center"},K&&e.createElement(ct,null),e.createElement(q.C,{disabled:s,name:ue,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Be} ${a}`}),onValueChange:Ce=>{f({target:{name:ue,value:Ce}})},indeterminate:ie,value:F})):e.createElement(at,{key:V,justifyContent:"center",alignItems:"center"},K&&e.createElement(ct,null),e.createElement(q.C,{disabled:s,indeterminate:K,name:ue,onValueChange:Ce=>{E({target:{name:ue,value:Ce}})},value:F})):e.createElement(Ge,{key:V}))),d&&e.createElement(I,{headerBreadCrumbs:[a,"Settings.permissions.conditions.conditions"],actions:T,isFormDisabled:s,onClosed:b,onToggle:k})),e.createElement(Gt,null,e.createElement(fe,{onClick:k,hasConditions:X})))};dt.propTypes={availableActions:i().array.isRequired,isActive:i().bool.isRequired,isGrey:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggle:i().func.isRequired,pathToData:i().string.isRequired};const Kt=dt,Ut=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),ut=(0,y.ZP)(P.k)`
  width: ${N};
  flex-shrink: 0;
`,zt=(0,y.ZP)(P.k)`
  width: ${ce};
  height: ${de};
  flex-shrink: 0;
`,mt=({headers:t,label:n})=>{const{formatMessage:o}=(0,W.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(P.k,null,e.createElement(zt,{alignItems:"center",paddingLeft:6},e.createElement(M.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(a=>a.isActionRelatedToCurrentProperty?e.createElement(ut,{justifyContent:"center",key:a.label},e.createElement(M.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${a.label.toLowerCase()}`,defaultMessage:a.label}))):e.createElement(ut,{key:a.label})))};mt.propTypes={headers:i().arrayOf(i().shape({label:i().string.isRequired,isActionRelatedToCurrentProperty:i().bool.isRequired})).isRequired,label:i().string.isRequired};const Xt=mt,Yt=y.ZP.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,pt=()=>e.createElement(Yt,null,"*"),wt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),Jt=(0,y.ZP)(j.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Qt=y.ZP.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Xe=t=>e.createElement(Jt,null,e.createElement(Qt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Xe.defaultProps={fill:"primary200"},Xe.propTypes={fill:i().string};const qt=(0,e.memo)(Xe),gt=(0,y.ZP)(P.k)`
  width: ${N};
  position: relative;
`,_t=(0,y.ZP)(P.k)`
  height: ${de};
`,en=(0,y.ZP)(j.x)`
  padding-left: ${31/16}rem;
`,tn=(0,y.ZP)(j.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,nn=(0,y.ZP)(P.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ie} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Fe(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Fe(n)};
`,sn=y.ZP.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Ye=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:a,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,W.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=(0,te.$_)(),[f,E]=(0,e.useState)(null),k=h=>{E(g=>g===h?null:h)},b=(0,e.useMemo)(()=>f?t.find(({value:h})=>h===f):null,[f,t]);return e.createElement(en,null,e.createElement(sn,null),t.map(({label:h,value:g,required:S,children:R},T)=>{const X=T+1<t.length,V=Array.isArray(R),K=f===g;return e.createElement(tn,{key:g,isVisible:X},e.createElement(_t,null,e.createElement(qt,{color:"primary200"}),e.createElement(P.k,{style:{flex:1}},e.createElement(nn,{level:o,isActive:K,isCollapsable:V},e.createElement(st,{alignItems:"center",isCollapsable:V,...V&&{onClick:()=>k(g),"aria-expanded":K,onKeyDown:({key:F})=>(F==="Enter"||F===" ")&&k(g),tabIndex:0,role:"button"},title:h},e.createElement(M.Z,{ellipsis:!0},ee()(h)),S&&e.createElement(pt,null),e.createElement(Ie,{$isActive:K}))),e.createElement(P.k,{style:{flex:1}},a.map(({actionId:F,label:ie,isActionRelatedToCurrentProperty:Me})=>{if(!Me)return e.createElement(Ge,{key:F});const w=[...s.split(".."),F,"properties",c,...l.split(".."),g],ue=C()(m,w,!1);if(!R)return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(q.C,{disabled:n,name:w.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${h} ${ie}`}),onValueChange:Ee=>{p({target:{name:w.join(".."),value:Ee}})},value:ue}));const{hasAllActionsSelected:Be,hasSomeActionsSelected:Ce}=ye(ue);return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(q.C,{key:ie,disabled:n,name:w.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${h} ${ie}`}),onValueChange:Ee=>{u({target:{name:w.join(".."),value:Ee}})},value:Be,indeterminate:Ce}))})))),b&&K&&e.createElement(j.x,{paddingBottom:2},e.createElement(Ye,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:a,propertyName:c,recursiveLevel:o+1,childrenForm:b.children})))}))};Ye.propTypes={childrenForm:i().array.isRequired,isFormDisabled:i().bool.isRequired,parentName:i().string.isRequired,pathToDataFromActionRow:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,recursiveLevel:i().number.isRequired};const on=(0,e.memo)(Ye),rn=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),an=(t,n,o,s,a)=>{const c=rn(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,a],p=C()(n,u,!1);return d[m]=p,d},{});return ye(c)},ft=(0,y.ZP)(P.k)`
  width: ${N};
  position: relative;
`,ln=(0,y.ZP)(P.k)`
  height: ${de};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ie} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Fe(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Fe(n)};
`,we=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:a,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,W.Z)(),[p,f]=(0,e.useState)(null),{modifiedData:E,onChangeCollectionTypeLeftActionRowCheckbox:k,onChangeParentCheckbox:b,onChangeSimpleCheckbox:h}=(0,te.$_)(),g=p===s,S=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),R=S.length>0,T=(0,e.useCallback)(()=>{R&&f(F=>F===s?null:s)},[R,s]),X=({target:{value:F}})=>{k(l,d,s,F)},{hasAllActionsSelected:V,hasSomeActionsSelected:K}=(0,e.useMemo)(()=>an(c,E,l,d,s),[c,E,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(ln,{alignItems:"center",isCollapsable:R,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(P.k,null,e.createElement(ot,{onChange:X,onClick:T,isCollapsable:R,isFormDisabled:o,label:n,someChecked:K,value:V,isActive:g},a&&e.createElement(pt,null),e.createElement(Ie,{$isActive:g})),e.createElement(P.k,null,c.map(({label:F,isActionRelatedToCurrentProperty:ie,actionId:Me})=>{if(!ie)return e.createElement(Ge,{key:F});const w=[...l.split(".."),Me,"properties",d,s];if(!R){const Ee=C()(E,w,!1);return e.createElement(ft,{key:Me,justifyContent:"center",alignItems:"center"},e.createElement(q.C,{disabled:o,name:w.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${F}`}),onValueChange:es=>{h({target:{name:w.join(".."),value:es}})},value:Ee}))}const ue=C()(E,w,{}),{hasAllActionsSelected:Be,hasSomeActionsSelected:Ce}=ye(ue);return e.createElement(ft,{key:F,justifyContent:"center",alignItems:"center"},e.createElement(q.C,{disabled:o,name:w.join(".."),onValueChange:Ee=>{b({target:{name:w.join(".."),value:Ee}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${F}`}),value:Be,indeterminate:Ce}))})))),g&&e.createElement(on,{childrenForm:S,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};we.defaultProps={childrenForm:[],required:!1},we.propTypes={childrenForm:i().array,label:i().string.isRequired,isFormDisabled:i().bool.isRequired,name:i().string.isRequired,pathToData:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,required:i().bool,isOdd:i().bool.isRequired};const cn=(0,e.memo)(we),dn=y.ZP.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,ht=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:a,propertyName:l})=>{const c=(0,e.useMemo)(()=>Ut(t,l),[t,l]);return e.createElement(dn,null,e.createElement(Xt,{label:s,headers:c}),e.createElement(j.x,null,n.map(({children:d,label:m,value:u,required:p},f)=>e.createElement(cn,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:a,propertyName:l,isOdd:f%2===0}))))};ht.propTypes={childrenForm:i().array.isRequired,availableActions:i().array.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,pathToData:i().string.isRequired,propertyName:i().string.isRequired};const un=ht,mn=y.ZP.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,yt=({allActions:t,contentTypeName:n,label:o,index:s,isActive:a,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>wt(t,n),[t,n]);return e.createElement(mn,{isActive:a},e.createElement(Kt,{availableActions:p,isActive:a,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),a&&m.map(({label:f,value:E,children:k})=>e.createElement(un,{availableActions:p,childrenForm:k,isFormDisabled:l,label:f,pathToData:d,propertyName:E,key:E})))};yt.propTypes={allActions:i().array.isRequired,contentTypeName:i().string.isRequired,index:i().number.isRequired,isActive:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggleCollapse:i().func.isRequired,pathToData:i().string.isRequired,properties:i().array.isRequired};const pn=yt,Je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[a,l]=(0,e.useState)(null),c=d=>{l(a===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(pn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:a===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};Je.defaultProps={actions:[],subjects:[]},Je.propTypes={actions:i().array.isRequired,isFormDisabled:i().bool.isRequired,pathToData:i().string.isRequired,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))};const gn=(0,e.memo)(Je),fn=t=>t.filter(({subjects:n})=>n&&n.length),hn=t=>t.map(({actionId:n})=>n),yn=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(a=>{const l=C()(n,[a,s],{}),c={[a]:Ue(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),Cn=(t,n)=>{const o=hn(t),s=yn(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=ye(s[c]),l),{})},En=(0,y.ZP)(P.k)`
  width: ${N};
  flex-shrink: 0;
`,Qe=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,W.Z)(),{modifiedData:a,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,te.$_)(),c=(0,e.useMemo)(()=>fn(t),[t]),d=(0,e.useMemo)(()=>Cn(c,a[o]),[a,c,o]);return e.createElement(j.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:ce}},e.createElement(P.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(En,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(M.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(q.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:C()(d,[u,"hasAllActionsSelected"],!1),indeterminate:C()(d,[u,"hasSomeActionsSelected"],!1)})))))};Qe.defaultProps={actions:[]},Qe.propTypes={actions:i().arrayOf(i().shape({label:i().string.isRequired,actionId:i().string.isRequired,subjects:i().array.isRequired})),isFormDisabled:i().bool.isRequired,kind:i().string.isRequired};const bn=(0,e.memo)(Qe),vn=(0,y.ZP)(j.x)`
  overflow-x: auto;
`,Ct=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const a=$e()([...s],"label");return e.createElement(vn,{background:"neutral0"},e.createElement(bn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(gn,{actions:o,isFormDisabled:t,pathToData:n,subjects:a}))};Ct.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().shape({actions:i().array,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))}).isRequired};const Et=(0,e.memo)(Ct);var xn=r(47713);const bt=({children:t,value:n})=>e.createElement(xn.$l.Provider,{value:n},t);bt.propTypes={children:i().node.isRequired,value:i().exact({availableConditions:i().array.isRequired,modifiedData:i().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:i().func.isRequired,onChangeConditions:i().func.isRequired,onChangeSimpleCheckbox:i().func.isRequired,onChangeParentCheckbox:i().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:i().func.isRequired}).isRequired};const Rn=bt;var An=r(48734),Pn=r(74756),Sn=r(63081),vt=r(36213),Tn=r(11276),On=r(74571);const Mn=(t,n,o)=>t.map(s=>{const a=[...o,s.action,"properties","enabled"],l=C()(n,a,!1),c=C()(n,[...o,s.action,"conditions"],{}),d=Oe(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:a.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),$n=t=>{const n=Object.entries(t).reduce((s,a)=>{const[l,{conditions:c}]=a;return s[l]=c,s},{});return Oe(n).some(s=>s)},Ln=y.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,Dn=y.ZP.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,xt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:a})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=(0,te.$_)(),{formatMessage:p}=(0,W.Z)(),f=C()(d,a,{}),E=(0,e.useMemo)(()=>Object.keys(f).reduce((T,X)=>(T[X]=Ue(f[X]),T),{}),[f]),{hasAllActionsSelected:k,hasSomeActionsSelected:b}=ye(E),h=()=>{c(T=>!T)},g=()=>{c(!1)},S=Mn(s,d,a),R=$n(C()(d,[...a],{}));return e.createElement(e.Fragment,null,e.createElement(j.x,null,e.createElement(P.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(j.x,{paddingRight:4},e.createElement(M.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(Ln,null),e.createElement(j.x,{paddingLeft:4},e.createElement(vt.X,{name:a.join(".."),disabled:n,onValueChange:T=>{m({target:{name:a.join(".."),value:T}})},indeterminate:b,value:k},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(P.k,{paddingTop:6,paddingBottom:6},e.createElement(Tn.r,{gap:2,style:{flex:1}},S.map(({checkboxName:T,value:X,action:V,displayName:K,hasConditions:F})=>e.createElement(On.P,{col:3,key:V},e.createElement(Dn,{disabled:n,hasConditions:F},e.createElement(vt.X,{name:T,disabled:n,onValueChange:ie=>{u({target:{name:T,value:ie}})},value:X},K))))),e.createElement(fe,{hasConditions:R,onClick:h}))),l&&e.createElement(I,{headerBreadCrumbs:[t,o],actions:S,isFormDisabled:n,onClosed:g,onToggle:h}))};xt.propTypes={actions:i().array.isRequired,categoryName:i().string.isRequired,isFormDisabled:i().bool.isRequired,subCategoryName:i().string.isRequired,pathToData:i().array.isRequired};const jn=xt,qe=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:a,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,W.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(An.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Pn.B,{title:ee()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(Sn.v,null,e.createElement(j.x,{padding:6},t.map(({actions:f,subCategoryName:E,subCategoryId:k})=>e.createElement(jn,{key:E,actions:f,categoryName:p,isFormDisabled:a,subCategoryName:E,pathToData:[...d,k]})))))};qe.defaultProps={},qe.propTypes={childrenForm:i().array.isRequired,isOpen:i().bool.isRequired,isFormDisabled:i().bool.isRequired,isWhite:i().bool.isRequired,kind:i().string.isRequired,name:i().string.isRequired,onOpenCategory:i().func.isRequired,pathToData:i().array.isRequired};const kn=qe,Rt=({isFormDisabled:t,kind:n,layout:o})=>{const[s,a]=(0,e.useState)(null),l=c=>{a(c===s?null:c)};return e.createElement(j.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(kn,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};Rt.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().arrayOf(i().shape({category:i().string.isRequired,categoryId:i().string.isRequired,childrenForm:i().arrayOf(i().shape({actions:i().array.isRequired})).isRequired}).isRequired).isRequired};const At=Rt;var Zn=r(82492),In=r.n(Zn),Fn=r(36968),oe=r.n(Fn);const Pt=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),St=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),Tt=({children:t},n,o="")=>t.reduce((s,a)=>{if(a.children)return{...s,[a.value]:Tt(a,n,`${o}${a.value}.`)};const l=n.indexOf(`${o}${a.value}`)!==-1;return s[a.value]=l,s},{}),Bn=(t,n,o)=>t.reduce((s,a)=>{const l=n.properties.find(({value:c})=>c===a);if(l){const c=C()(o,["properties",l.value],[]),d=Tt(l,c);s.properties[a]=d}return s},{properties:{}}),Nn=(t,n)=>n.reduce((o,s)=>{const a=t.find(({uid:l})=>l===s)||null;return a&&(o[s]=a),o},{}),Ot=({subjects:t},n,o,s=[])=>n.reduce((a,l)=>{const c=l.subjects,d=Nn(t,c);if(Z()(d))return a;const m=Object.keys(d).reduce((u,p)=>{const{actionId:f,applyToProperties:E}=l,h=d[p].properties.map(({value:T})=>T).every(T=>(E||[]).indexOf(T)===-1),g=Pt(s,f,p),S=St(o,C()(g,"conditions",[]));if(Z()(E)||h)return oe()(u,[p,f],{properties:{enabled:g!==void 0},conditions:S}),u;const R=Bn(E,d[p],g);return oe()(u,[p,f],{...R,conditions:S}),u},{});return In()(a,m)},{}),Vn=(t,n,o)=>t.reduce((s,a)=>{const l=Pt(o,a.action,null);return s[a.action]={properties:{enabled:l!==void 0},conditions:St(n,l?.conditions??[])},s},{}),Wn=(t,n,o)=>t.reduce((s,a)=>(s[a.subCategoryId]=Vn(a.actions,n,o),s),{}),Mt=(t,n,o=[])=>t.reduce((s,{categoryId:a,childrenForm:l})=>{const c=Wn(l,n,o);return s[a]=c,s},{}),$t=t=>t.split(" ").join("-"),Lt=(t,n)=>Object.entries(_()(t,n)).map(([o,s])=>({category:o,categoryId:$t(o),childrenForm:Object.entries(_()(s,"subCategory")).map(([a,l])=>({subCategoryName:a,subCategoryId:$t(a),actions:l}))})),Hn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:a,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:a,plugins:Lt(l,"plugin"),settings:Lt(c,"category")},m={collectionTypes:Ot(s,s.actions||[],o,n),singleTypes:Ot(a,a.actions||[],o,n),plugins:Mt(d.plugins,o,n),settings:Mt(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Gn=r(50361),_e=r.n(Gn);const Dt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(pe()(s)&&!O()(s,"conditions"))return{...n,[o]:Dt(s)};if(pe()(s)&&O()(s,"conditions")&&!Oe(me()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),et=Dt,jt=(t,n,o=!1)=>Object.keys(t).reduce((s,a)=>{const l=t[a];return a==="conditions"&&!o?(s[a]=l,s):pe()(l)?{...s,[a]:jt(l,n,a==="fields")}:(s[a]=n,s)},{}),We=jt,Kn={initialData:{},modifiedData:{},layouts:{}},Un=(t,n)=>(0,J.ZP)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:a,value:l}=n,c=["modifiedData",s];Object.keys(C()(t,c)).forEach(d=>{const m=C()(t,[...c,d,a],void 0);if(m){let u=We(m,l);if(!l&&u.conditions){const p=We(u.conditions,!1);u={...u,conditions:p}}oe()(o,[...c,d,a],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:a,rowName:l,value:c}=n;let d=_e()(t.modifiedData);const m=s.split(".."),u=C()(d,m,{});Object.keys(u).forEach(p=>{if(O()(u[p],`properties.${a}`)){const f=C()(u,[p,"properties",a,l]),E=[...m,p,"properties",a,l];if(!pe()(f))oe()(d,E,c);else{const k=We(f,c);oe()(d,E,k)}}}),c||(d=et(d)),oe()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[a,l]=s;oe()(o,["modifiedData",...a.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=_e()(t.modifiedData);oe()(s,[...n.keys.split("..")],n.value),n.value||(s=et(s)),oe()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:a}=n,l=[...s.split("..")];let c=_e()(t.modifiedData);const d=C()(c,l,{}),m=We(d,a);oe()(c,l,m),a||(c=et(c)),oe()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),tt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),zn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:tt(o),properties:{}}},Xn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((a,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return a;const d=zn(l);return a.push(d),a},[]);return[...n,...s]},[]),kt=t=>Object.values(t).reduce((n,o)=>{const s=Xn(o);return[...n,...s]},[]),Zt=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[a,l]=s;return pe()(l)?[...o,...Zt(l,`${n}${a}.`)]:(l&&!pe()(l)&&o.push(`${n}${a}`),o)},[]),Yn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((a,l)=>{const[c,d]=l;return a.properties[c]=Zt(d),a},{action:t,subject:n,conditions:tt(o),properties:{}}),wn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:tt(o)}),Jn=(t,n)=>Object.entries(n).reduce((s,a)=>{const[l,c]=a;if(!Oe(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=Yn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=wn(l,t,c);return s.push(m),s},[]),It=t=>Object.entries(t).reduce((o,s)=>{const[a,l]=s,c=Jn(a,l);return[...o,...c]},[]),Qn=t=>{const n=kt(t.plugins),o=kt(t.settings),s=It(t.collectionTypes),a=It(t.singleTypes);return[...n,...o,...s,...a]},qn=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],nt=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:a,layouts:l,modifiedData:c},d]=(0,e.useReducer)(Un,Kn,()=>Hn(t,o)),{formatMessage:m}=(0,W.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const b=(0,D.e5)(a.collectionTypes,c.collectionTypes),h=(0,D.e5)(a.singleTypes,c.singleTypes),g={...b,...h};let S;return Z()(g)?S=!1:S=Object.values(g).some(R=>Object.values(R).some(T=>O()(T,"conditions"))),{permissionsToSend:Qn(c),didUpdateConditions:S}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(b,h,g,S)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:b,propertyName:h,rowName:g,value:S})},p=(b,h,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:b,actionId:h,value:g})},f=b=>{d({type:"ON_CHANGE_CONDITIONS",conditions:b})},E=(0,e.useCallback)(({target:{name:b,value:h}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:b,value:h})},[]),k=(0,e.useCallback)(({target:{name:b,value:h}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:b,value:h})},[]);return e.createElement(Rn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:f,onChangeSimpleCheckbox:E,onChangeParentCheckbox:k,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(B.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(x.m,null,qn.map(b=>e.createElement(x.O,{key:b.id},m({id:b.labelId,defaultMessage:b.defaultMessage})))),e.createElement(A.n,{style:{position:"relative"}},e.createElement(A.x,null,e.createElement(Et,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(A.x,null,e.createElement(Et,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(A.x,null,e.createElement(At,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(A.x,null,e.createElement(At,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});nt.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},nt.propTypes={layout:i().object,isFormDisabled:i().bool.isRequired,permissions:i().array};const _n=(0,e.memo)(nt)},92100:(Y,G,r)=>{"use strict";r.r(G),r.d(G,{default:()=>H});var e=r(53547),v=r(86597),i=r(16550),D=r(87751),B=r(185),x=r(53979),A=r(11047),$=r(29728),O=r(49066),U=r(41580),Z=r(41054),W=r(67109),j=r(27361),y=r.n(j),be=r(86896),$e=r(18280),ve=r(75515),Le=r(11276),P=r(74571),q=r(16364),De=r(61467),C=r(45697),re=r.n(C);const me=({disabled:ne,role:M,values:L,errors:J,onChange:se,onBlur:_})=>{const{formatMessage:z}=(0,be.Z)();return e.createElement(U.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(A.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(A.k,{justifyContent:"space-between"},e.createElement(U.x,null,e.createElement(U.x,null,e.createElement(ve.Z,{fontWeight:"bold"},M?M.name:z({id:"global.details",defaultMessage:"Details"}))),e.createElement(U.x,null,e.createElement(ve.Z,{textColor:"neutral500",variant:"pi"},M?M.description:z({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement($.z,{disabled:!0,variant:"secondary"},z({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:M.usersCount}))),e.createElement(Le.r,{gap:4},e.createElement(P.P,{col:6},e.createElement(q.o,{disabled:ne,name:"name",error:J.name&&z({id:J.name}),label:z({id:"global.name",defaultMessage:"Name"}),onChange:se,onBlur:_,value:L.name||""})),e.createElement(P.P,{col:6},e.createElement(De.g,{disabled:ne,label:z({id:"global.description",defaultMessage:"Description"}),id:"description",error:J.name&&z({id:J.name}),onChange:se,onBlur:_},L.description||"")))))};me.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},me.propTypes={disabled:re().bool,errors:re().object.isRequired,onBlur:re().func.isRequired,onChange:re().func.isRequired,role:re().object,values:re().object};const te=me;var xe=r(95428),ae=r(87561);const ge=ae.Ry().shape({name:ae.Z_().required(v.I0.required)}),Re=()=>{const ne=(0,v.lm)(),{formatMessage:M}=(0,be.Z)(),{params:{id:L}}=(0,i.$B)("/settings/roles/:id"),[J,se]=(0,e.useState)(!1),_=(0,e.useRef)(),{lockApp:z,unlockApp:ee}=(0,v.o1)(),{trackUsage:je}=(0,v.rS)(),{isLoading:he,data:ke}=(0,xe.U_)(L),{role:le,permissions:Ae,isLoading:Pe,onSubmitSucceeded:Ze}=(0,xe.Dq)(L),{put:Se}=(0,v.kY)(),Ve=async Q=>{try{z(),se(!0);const{permissionsToSend:I,didUpdateConditions:N}=_.current.getPermissions();await Se(`/admin/roles/${L}`,Q),le.code!=="strapi-super-admin"&&(await Se(`/admin/roles/${L}/permissions`,{permissions:I}),N&&je("didUpdateConditions")),_.current.setFormAfterSubmit(),Ze({name:Q.name,description:Q.description}),ne({type:"success",message:{id:"notification.success.saved"}})}catch(I){console.error(I.response);const N=y()(I,"response.payload.message","An error occured"),ce=y()(I,"response.payload.data.permissions[0]",N);ne({type:"warning",message:ce})}finally{se(!1),ee()}},Te=le.code==="strapi-super-admin";return e.createElement(B.o,null,e.createElement(v.SL,{name:"Roles"}),e.createElement(Z.J9,{enableReinitialize:!0,initialValues:{name:le.name,description:le.description},onSubmit:Ve,validationSchema:ge,validateOnChange:!1},({handleSubmit:Q,values:I,errors:N,handleChange:ce,handleBlur:de})=>e.createElement("form",{onSubmit:Q},e.createElement(x.T,{primaryAction:e.createElement(A.k,{gap:2},e.createElement($.z,{disabled:le.code==="strapi-super-admin",onClick:Q,loading:J,size:"L"},M({id:"global.save",defaultMessage:"Save"}))),title:M({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:M({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(v.rU,{startIcon:e.createElement(W.Z,null),to:"/settings/roles"},M({id:"global.back",defaultMessage:"Back"}))}),e.createElement(O.D,null,e.createElement(A.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(te,{isLoading:Pe,disabled:Te,errors:N,values:I,onChange:ce,onBlur:de,role:le}),!he&&!Pe?e.createElement(U.x,{shadow:"filterShadow",hasRadius:!0},e.createElement($e.Z,{isFormDisabled:Te,permissions:Ae,ref:_,layout:ke})):e.createElement(U.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(v.dO,null)))))))},H=()=>{const ne=(0,e.useMemo)(()=>({read:D.Z.settings.roles.read,update:D.Z.settings.roles.update}),[]),{isLoading:M,allowedActions:{canRead:L,canUpdate:J}}=(0,v.ss)(ne);return M?e.createElement(v.dO,null):!L&&!J?e.createElement(i.l_,{to:"/"}):e.createElement(Re,null)}},44174:Y=>{function G(r,e,v,i){for(var D=-1,B=r==null?0:r.length;++D<B;){var x=r[D];e(i,x,v(x),r)}return i}Y.exports=G},81119:(Y,G,r)=>{var e=r(89881);function v(i,D,B,x){return e(i,function(A,$,O){D(x,A,B(A),O)}),x}Y.exports=v},55189:(Y,G,r)=>{var e=r(44174),v=r(81119),i=r(67206),D=r(1469);function B(x,A){return function($,O){var U=D($)?e:v,Z=A?A():{};return U($,x,i(O,2),Z)}}Y.exports=B},42348:(Y,G,r)=>{var e=r(21078),v=1/0;function i(D){var B=D==null?0:D.length;return B?e(D,v):[]}Y.exports=i},7739:(Y,G,r)=>{var e=r(89465),v=r(55189),i=Object.prototype,D=i.hasOwnProperty,B=v(function(x,A,$){D.call(x,$)?x[$].push(A):e(x,$,[A])});Y.exports=B},2407:(Y,G,r)=>{"use strict";r.d(G,{$:()=>O,O:()=>U});var e=r(85893),v=r(16405),i=r(88972),D=r(63237),B=r(11047),x=r(41580),A=r(75515);const $=(0,i.ZP)(B.k)`
  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
    path {
      fill: ${({theme:Z})=>Z.colors.neutral500};
    }
  }
  :last-of-type ${x.x} {
    display: none;
  }
  :last-of-type ${A.Z} {
    color: ${({theme:Z})=>Z.colors.neutral800};
    font-weight: ${({theme:Z})=>Z.fontWeights.bold};
  }
`,O=({children:Z})=>(0,e.jsxs)($,{inline:!0,as:"li",children:[(0,e.jsx)(A.Z,{variant:"pi",textColor:"neutral600",children:Z}),(0,e.jsx)(x.x,{"aria-hidden":!0,paddingLeft:3,paddingRight:3,children:(0,e.jsx)(v.Z,{})})]});O.displayName="Crumb";const U=({children:Z,label:W,...j})=>(0,e.jsxs)(B.k,{...j,children:[(0,e.jsx)(D.T,{children:W}),(0,e.jsx)("ol",{"aria-hidden":!0,children:Z})]});U.displayName="Breadcrumbs"},38953:(Y,G,r)=>{"use strict";r.d(G,{Q:()=>D});var e=r(85893),v=r(88972),i=r(67730);const D=({options:x,...A})=>(0,e.jsx)(i.NU,{...A,children:x.map($=>"children"in $?(0,e.jsx)(i.Ab,{label:$.label,values:$.children.map(O=>O.value.toString()),children:$.children.map(O=>(0,e.jsx)(B,{value:O.value,children:O.label},O.value))},$.label):(0,e.jsx)(i.ML,{value:$.value,children:$.label},$.value))}),B=(0,v.ZP)(i.ML)`
  padding-left: ${({theme:x})=>x.spaces[7]};
`}}]);
